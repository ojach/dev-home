<!-- ver.0.4 DBé€£æºç‰ˆ -->
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OJapp Builder</title>

<!-- Favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16.png">
<link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32.png">
<link rel="icon" type="image/png" sizes="64x64" href="icon/favicon-64.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon/icon-180.png">
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#2bb7ff">

<link rel="stylesheet" href="style.css">
<script src="/OJapp/darkmode.js"></script>
</head>

<body>

<!-- â–¼ HEADER -->
<div id="header"></div>
<script>
fetch("/OJapp/header.html").then(r=>r.text()).then(h=>header.innerHTML=h)
</script>

<div style="text-align:center;margin-top:10px;">
<button id="loginGithub" style="
  background:#24292f;color:#fff;padding:8px 14px;border:none;
  border-radius:6px;font-size:14px;cursor:pointer;">
  ğŸ” Sign in with GitHub
</button>
</div>

<!-- ================= MAIN ================= -->
<div class="main">

<h2>ãƒ›ãƒ¼ãƒ ã‚’å¤‰ãˆã‚‹ è‡ªåˆ†ã‚’å¤‰ãˆã‚‹</h2>

<div class="center" style="margin-bottom:10px;">
  <button id="createBtn" onclick="createApp()" class="btn pulse">Create App ğŸ‰</button>
  <div class="arrow">â–¼</div>
</div>

<!-- Step1 -->
<div class="section">
  <div class="section-title">Step1ï¼šã‚¢ã‚¤ã‚³ãƒ³ç”»åƒ</div>
  <input type="file" id="iconInput">
  <div class="icon-box"><img id="preview"></div>
</div>

<!-- Step2 -->
<div class="section">
  <div class="section-title">Step2ï¼šã‚¢ãƒ—ãƒªå</div>
  <input type="text" id="appName" placeholder="OJACH PORTAL">
</div>

<!-- Step3 -->
<div class="section">
  <div class="section-title">Step3ï¼šURL</div>
  <input type="text" id="appURL" placeholder="https://example.com">
</div>

<div id="assistantBox">ãŠã¡ã‚ƒã˜å‚ä¸ŠğŸ˜âœ¨</div>

<!-- â–¼ LINK AREA â–¼ -->
<div class="center" style="margin-top:20px;"><a href="/OJapp/safety/" class="guide-link">å®‰å…¨æ€§ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³</a></div>
<div class="center" style="margin-top:12px;"><a href="/OJapp/guide/" class="guide-link">ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</a></div>
<div class="center" style="margin-top:12px;"><a href="/OJapp/faq/" class="guide-link">ã‚ˆãã‚ã‚‹è³ªå•</a></div>
<div class="center" style="margin-top:12px;"><a href="/OJapp/changelog/" class="guide-link">æ›´æ–°å±¥æ­´</a></div>
<div class="center" style="margin-top:12px;"><a href="https://discord.gg/KZjN5uSBHu" class="guide-link">å…¬å¼Discord</a></div>
<div class="center" style="margin-top:12px;"><a href="/OJapp/support" class="guide-link">é–‹ç™ºæ”¯æ´</a></div>

<!-- FOOTER -->
<div id="footer"></div>
<script>
fetch("/OJapp/footer.html").then(r=>r.text()).then(h=>footer.innerHTML=h)
</script>
</div><!-- main -->

<!-- â–¼ DBä¿å­˜å‡¦ç† JS (POST) â–¼ -->
<script>

// ---- ä¿å­˜é€ä¿¡ãƒ‡ãƒ¼ã‚¿ ----
const send = {
  user_id: "guest",      // â† ä»Šã¯å¸¸ã«guestã§ç™»éŒ²
  name: name,
  app_url: url,
  icon_url: iconName
};

const res = await fetch("https://ojapp-auth.trc-wasps.workers.dev/api/create",{
  method:"POST",
  headers:{ "Content-Type":"application/json"},
  body: JSON.stringify(send)
});

const result = await res.json();

if(result.status==="ok"){
  alert("ä¿å­˜æˆåŠŸğŸ‰\nURLç™ºè¡Œï¼š"+ result.access_url);
} else {
  console.error(result);
  alert("ä¿å­˜å¤±æ•—ğŸ’¥");
}

// ã‚¢ã‚¤ã‚³ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
// ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
const iconInput = document.getElementById("iconInput");
const preview = document.getElementById("preview");

iconInput.addEventListener("change", () => {
  const file = iconInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    preview.src = e.target.result; // â† innerHTMLã˜ã‚ƒãªãsrc
  };
  reader.readAsDataURL(file);
});
</script>
<script src="app.js"></script>
</body>
</html>

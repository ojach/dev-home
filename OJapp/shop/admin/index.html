<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>OJapp Shop Admin</title>

<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
    background: #f7f9fc;
    padding: 20px;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 24px;
    font-weight: 700;
  }

  .form-box {
    background: #ffffff;
    border-radius: 16px;
    padding: 20px;
    max-width: 440px;
    margin: 0 auto;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
  }

  .input-group {
    margin-bottom: 16px;
  }

  .input-group label {
    font-size: 14px;
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
  }

  .input-group input,
  .input-group select {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: 1px solid #dde3ea;
    background: #fdfdfd;
    font-size: 15px;
  }

  .thumb-preview {
    width: 100%;
    aspect-ratio: 1/1;
    border-radius: 16px;
    object-fit: cover;
    border: 1px solid #e5e5e5;
    margin-bottom: 12px;
    display: none;
  }

  .submit-btn {
    width: 100%;
    background: linear-gradient(135deg, #2bb7ff, #4d8cff);
    color: white;
    border: none;
    padding: 14px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.2s;
  }

  .submit-btn:active {
    opacity: 0.7;
  }

  .result-box {
    text-align: center;
    margin-top: 20px;
    font-size: 15px;
    color: #333;
    display: none;
  }
</style>
</head>

<body>
  <script>
(() => {
  const KEY = "ojshop-admin-designer"; // ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ä¿å­˜ã‚­ãƒ¼

  // ã™ã§ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ã‚¹ã‚­ãƒƒãƒ—
  if (localStorage.getItem(KEY)) return;

  const input = prompt(
    "ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼å°‚ç”¨ãƒšãƒ¼ã‚¸ã§ã™ã€‚\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š"
  );

  if (!input) {
    alert("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ");
    location.href = "/OJapp/shop/";
    return;
  }

  // æœ€å¾Œã®3æ¡ãŒ 778 ã‹ãƒã‚§ãƒƒã‚¯
  if (!input.endsWith("778")) {
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚");
    location.href = "/OJapp/shop/";
    return;
  }

  // ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼åã‚’åˆ‡ã‚Šå‡ºã™
  const designer = input.slice(0, -3); // æœ«å°¾3æ–‡å­—ã‚’é™¤å¤–

  // ä¿å­˜
  localStorage.setItem(KEY, designer);

  alert("ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼ã‚ˆã†ã“ã " + designer + " ã•ã‚“");
})();
</script>

  <h1>ğŸ›’ OJapp Shop Admin</h1>

  <div class="form-box">
    <img id="preview" class="thumb-preview">

    <div class="input-group">
      <label>ã‚µãƒ ãƒç”»åƒ</label>
      <input type="file" id="thumb" accept="image/*">
    </div>

    <div class="input-group">
      <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
      <input type="text" id="title">
    </div>

    <div class="input-group">
      <label>ä½œè€…å</label>
      <input type="text" id="author">
    </div>

    <div class="input-group">
      <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
      <input type="text" id="category">
    </div>

    <div class="input-group">
      <label>ä¾¡æ ¼ï¼ˆæ•°å­—ã®ã¿ï¼‰</label>
      <input type="number" id="price">
    </div>

    <div class="input-group">
      <label>å…¬é–‹ã™ã‚‹</label>
      <select id="visible">
        <option value="1">å…¬é–‹</option>
        <option value="0">éå…¬é–‹</option>
      </select>
    </div>

    <button class="submit-btn" id="submit">å•†å“ã‚’ç™»éŒ²ã™ã‚‹</button>

    <div class="result-box" id="result"></div>
  </div>


<script>
// ============================
// ã‚µãƒ ãƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
// ============================
document.getElementById("thumb").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;

  const preview = document.getElementById("preview");
  preview.src = URL.createObjectURL(file);
  preview.style.display = "block";
});

// ============================
// ç™»éŒ²
// ============================
document.getElementById("submit").addEventListener("click", async () => {
  const file = document.getElementById("thumb").files[0];
  const title = document.getElementById("title").value;
  const author = document.getElementById("author").value;
  const category = document.getElementById("category").value;
  const price = document.getElementById("price").value;
  const visible = document.getElementById("visible").value;

  if (!file || !title || !author) {
    alert("ç”»åƒãƒ»ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ä½œè€…åã¯å¿…é ˆã§ã™ï¼");
    return;
  }

  const fd = new FormData();
  fd.append("thumbnail", file);
  fd.append("title", title);
  fd.append("author", author);
  fd.append("category", category);
  fd.append("price", price);
  fd.append("visible", visible);

  const res = await fetch("/shop/admin/app", {  // â† Workers ãƒ«ãƒ¼ãƒˆã«åˆã‚ã›ã‚‹
    method: "POST",
    body: fd
  });

  const json = await res.json();
  document.getElementById("result").style.display = "block";

  if (json.ok) {
    document.getElementById("result").innerHTML =
      `ç™»éŒ²å®Œäº†ï¼<br>product_idï¼š<b>${json.product_id}</b>`;
  } else {
    document.getElementById("result").innerHTML =
      "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
  }
});
</script>

</body>
</html>
